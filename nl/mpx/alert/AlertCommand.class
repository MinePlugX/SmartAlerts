package nl.mpx.alert;

import java.util.Iterator;
import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.Sound;
import org.bukkit.command.Command;
import org.bukkit.command.CommandExecutor;
import org.bukkit.command.CommandSender;
import org.bukkit.entity.Player;
import org.bukkit.event.Listener;

public class AlertCommand implements CommandExecutor, Listener {
    Configuration conf = new Configuration();
    AdminGUI adminGUI = new AdminGUI();

    public AlertCommand() {
    }

    public boolean onCommand(CommandSender sender, Command command, String label, String[] args) {
        if (!(sender instanceof Player)) {
            sender.sendMessage("> I love dogs too!");
            sender.sendMessage("> No but seriously, only players can use this!");
            return true;
        } else {
            Player p = (Player)sender;
            if (!p.hasPermission("alert.use")) {
                p.sendMessage(this.conf.message3);
                return false;
            } else {
                if (command.getName().equalsIgnoreCase("alert")) {
                    String alert = "";

                    for(int i = 0; i < args.length; ++i) {
                        String arg = args[i] + " ";
                        alert = alert + arg;
                    }

                    if (args.length == 0) {
                        p.sendMessage(this.conf.message2);
                        return true;
                    }

                    if (alert.startsWith("admin")) {
                        if (!p.hasPermission("alert.admin")) {
                            p.sendMessage(this.conf.getError());
                            return true;
                        }

                        p.sendMessage(this.conf.message7);
                        AdminGUI var10000 = this.adminGUI;
                        AdminGUI.openInv(p);
                        return true;
                    }

                    if (Alert.getMech().getConfig().getBoolean("chat-alert")) {
                        Bukkit.broadcastMessage(this.conf.message1 + "ยง6 " + p.getName() + "ยงc: " + this.conf.message6 + alert);
                    }

                    if (Alert.getMech().getConfig().getBoolean("title-feature")) {
                        Title title = new Title(this.conf.message4, this.conf.message5 + alert);
                        title.setSubtitleColor(ChatColor.YELLOW);
                        title.broadcast();
                    }

                    if (Alert.getMech().getConfig().getBoolean("sound-feature")) {
                        Iterator i$ = Bukkit.getOnlinePlayers().iterator();

                        String actionbarcolour;
                        Player all;
                        while(i$.hasNext()) {
                            all = (Player)i$.next();
                            actionbarcolour = Alert.getMech().getConfig().getString("sound-effect");
                            all.playSound(p.getLocation(), Sound.valueOf(actionbarcolour), 1.0F, 1.8F);
                        }

                        if (Alert.getMech().getConfig().getBoolean("actionbar-feature")) {
                            i$ = Bukkit.getOnlinePlayers().iterator();

                            while(i$.hasNext()) {
                                all = (Player)i$.next();
                                actionbarcolour = Alert.getMech().getConfig().getString("actionbar-colour");
                                ActionBar.sendActionBar(all, actionbarcolour + alert);
                            }
                        }
                    }
                }

                return false;
            }
        }
    }
}
